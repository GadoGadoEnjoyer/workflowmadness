name: Build & Deploy
on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Set up SSH Agent
        uses: appleboy/ssh-action@master
        with:
          host: ${{secrets.SSH_HOST}}
          key: ${{secrets.SSH_KEY}}
          username: ${{secrets.SSH_USERNAME}}
          passphrase: ${{secrets.SSH_PASSPHRASE}}

      - name: Deploy app
        run: |
          DEPLOY_DIR="/var/www/sukaair/vote"

          # Check if the directory already exists
          if [ ! -d "$DEPLOY_DIR" ]; then
            sudo mkdir -p "$DEPLOY_DIR"
            sudo chown $USER:$USER "$DEPLOY_DIR"  # Set ownership to the current user
          fi

          # Clone your GitHub repository into the directory
          git clone git@github.com:GadoGadoEnjoyer/vote.git "$DEPLOY_DIR"

          # Additional deployment steps, if needed
          # For example, you might need to install dependencies, build your project, etc.

          # Optionally, restart your web server to apply changes
          # Replace 'your-web-server-command' with the appropriate command for your server
          # sudo your-web-server-command
          
          echo "Deployment successful to $DEPLOY_DIR"
